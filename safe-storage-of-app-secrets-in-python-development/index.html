<!doctype html><html lang=en-au><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content="Michail Konst"><meta property="og:type" content="article"><meta property="og:image" content="https://www.michailkonst.com//img/home.jpg"><meta property="twitter:image" content="https://www.michailkonst.com//img/home.jpg"><meta name=title content="Safe Storage of App Secrets in Python Development"><meta property="og:title" content="Safe Storage of App Secrets in Python Development"><meta property="twitter:title" content="Safe Storage of App Secrets in Python Development"><meta name=description content><meta property="og:description" content><meta property="twitter:description" content><meta property="og:url" content="https://www.michailkonst.com/safe-storage-of-app-secrets-in-python-development/"><meta property="twitter:card" content="Discover an effective method for securely storing and managing sensitive app secrets in Python development."><meta name=keyword content><link rel="shortcut icon" href=/img/favicon.ico><title>Safe Storage of App Secrets in Python Development | Michail Konst</title>
<link rel=canonical href=/safe-storage-of-app-secrets-in-python-development/><link rel=alternate type=application/rss+xml title="Michail Konst" href=/index.xml><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/hugo-theme-cleanwhite.min.css><link rel=stylesheet href=/css/zanshang.min.css><link rel=stylesheet href=/css/font-awesome.all.min.css><link rel=stylesheet href=https://www.michailkonst.com/css/custom.css><script src=/js/jquery.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/hux-blog.min.js></script><script src=/js/lazysizes.min.js></script></head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=/>Michail Konst</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/>All Posts</a></li><li><a href=/about//>ABOUT</a></li><li><a href=/search><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");$toggle.addEventListener("click",handleMagic);function handleMagic(){$navbar.className.indexOf("in")>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script><style type=text/css>header.intro-header{background-image:url(/img/home.jpg)}</style><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags></div><h1>Safe Storage of App Secrets in Python Development</h1><h2 class=subheading></h2><span class=meta>Posted by
Michail Konst
on
Saturday, September 7, 2024</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><p>When developing software, one of the most critical aspects of securing your application is managing sensitive data like API keys, database credentials, and other secrets. In Python, handling these secrets can sometimes be tricky, especially during development, where ease of use can often lead to risky practices like storing sensitive data in source control.</p><p>In this blog post, we’ll see how we can securely manage our application secrets in Python using a method similar to <strong>.NET’s Secret Manager</strong>, ensuring that secrets remain out of your source control while still being easy to use during development.</p><h2 id=keep-secrets-outside-of-source-control>Keep Secrets Outside of Source Control</h2><p>One of the most important principles of managing secrets is: <strong>never store them in source control</strong>. Secrets that are checked into your version control system can be accessed by anyone with access to your repository, leading to potentially devastating security breaches. To avoid this, always ensure sensitive files are excluded from version control.</p><h2 id=ignore-sensitive-files-in-source-control>Ignore Sensitive Files in Source Control</h2><p>To prevent committing sensitive configuration files, such as secret settings, to your repository, you need to configure your version control system to ignore them. This is typically done by adding an ignore rule for the secrets file (for example, <code>appconfig.secrets.py</code>) in your project’s configuration. The exact method for doing this will depend on your version control system (e.g., Git, Mercurial, etc.).</p><h2 id=structuring-your-configuration-data>Structuring Your Configuration Data</h2><p>A good practice is to structure your configuration data using Python’s dataclass. This keeps the configuration organized and maintainable. Here’s an example of a Config class that holds your database connection settings and a third-party API endpoint:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> dataclasses <span style=color:#f92672>import</span> dataclass
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> Optional
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@dataclass</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Connection</span>:
</span></span><span style=display:flex><span>    server: str
</span></span><span style=display:flex><span>    database: str
</span></span><span style=display:flex><span>    user: str
</span></span><span style=display:flex><span>    password: str
</span></span><span style=display:flex><span>    port: Optional[str] <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@dataclass</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Api</span>:
</span></span><span style=display:flex><span>    endpoint: str
</span></span><span style=display:flex><span>    key: str
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@dataclass</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Config</span>:
</span></span><span style=display:flex><span>    connection: Connection
</span></span><span style=display:flex><span>    api: Api
</span></span></code></pre></div><p>This Config class allows you to neatly organize the configuration values you need, separating them into structured fields for easy access and management.</p><h2 id=example-of-configuration-data>Example of Configuration Data</h2><p>In your configuration, you would set the basic values for your app but leave sensitive information like passwords out of it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>config <span style=color:#f92672>=</span> Config(
</span></span><span style=display:flex><span>    connection<span style=color:#f92672>=</span>Connection(
</span></span><span style=display:flex><span>        server<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;my-database-server&#39;</span>,
</span></span><span style=display:flex><span>        port<span style=color:#f92672>=</span><span style=color:#ae81ff>1234</span>,
</span></span><span style=display:flex><span>        database<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;db_catalogue&#39;</span>,
</span></span><span style=display:flex><span>        user<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;user&#39;</span>,
</span></span><span style=display:flex><span>        password<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&lt;will be read from secrets&gt;&#39;</span>
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    api <span style=color:#f92672>=</span> Api(
</span></span><span style=display:flex><span>        third_party_api_endpoint<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://example.com&#34;</span>,
</span></span><span style=display:flex><span>        key<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&lt;will be read from secrets&gt;&#39;</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>As seen above, the database password and API key are left as placeholders because they will be dynamically loaded from the secrets file later.</p><h2 id=defining-the-secrets-file>Defining the Secrets File</h2><p>Now, let’s define the structure of the <code>appconfig.secrets.py</code> file, which will contain the actual sensitive data. Here’s what the secrets file might look like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> lib.configuration <span style=color:#66d9ef>as</span> config
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>config<span style=color:#f92672>.</span>connection<span style=color:#f92672>.</span>password <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;actual mega-secret password&#34;</span>
</span></span><span style=display:flex><span>config<span style=color:#f92672>.</span>api<span style=color:#f92672>.</span>key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;actual mega-secret key&#34;</span>
</span></span></code></pre></div><p>In this file, we’re directly modifying the configuration by assigning the real values to the placeholders in the config object that was imported from appconfig.py. You can include other sensitive information this file as well.</p><h2 id=loading-configuration-and-secrets>Loading Configuration and Secrets</h2><p>Now, let’s look at a simple and secure way to load both regular configuration and sensitive secrets. You can do this by having a primary configuration file (appconfig.py) that contains the non-sensitive values, and a separate secrets file (appconfig.secrets.py) for sensitive data.</p><p>Here’s a Python script that loads both configuration and secrets:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> importlib.util
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Load the main config file</span>
</span></span><span style=display:flex><span>spec <span style=color:#f92672>=</span> importlib<span style=color:#f92672>.</span>util<span style=color:#f92672>.</span>spec_from_file_location(
</span></span><span style=display:flex><span>    name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;appconfig&#34;</span>,
</span></span><span style=display:flex><span>    location<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;appconfig.py&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>my_module <span style=color:#f92672>=</span> importlib<span style=color:#f92672>.</span>util<span style=color:#f92672>.</span>module_from_spec(spec)
</span></span><span style=display:flex><span>spec<span style=color:#f92672>.</span>loader<span style=color:#f92672>.</span>exec_module(my_module)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Check for the secrets file and load it if present</span>
</span></span><span style=display:flex><span>secrets_file <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;appconfig.secrets.py&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(secrets_file):
</span></span><span style=display:flex><span>    secrets_spec <span style=color:#f92672>=</span> importlib<span style=color:#f92672>.</span>util<span style=color:#f92672>.</span>spec_from_file_location(
</span></span><span style=display:flex><span>        name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;appconfig_secrets&#34;</span>,
</span></span><span style=display:flex><span>        location<span style=color:#f92672>=</span>secrets_file
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> secrets_spec<span style=color:#f92672>.</span>loader <span style=color:#f92672>is</span> <span style=color:#f92672>not</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        secrets_module <span style=color:#f92672>=</span> importlib<span style=color:#f92672>.</span>util<span style=color:#f92672>.</span>module_from_spec(secrets_spec)
</span></span><span style=display:flex><span>        secrets_spec<span style=color:#f92672>.</span>loader<span style=color:#f92672>.</span>exec_module(secrets_module)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Override sensitive values in the main config with values from the secrets file</span>
</span></span><span style=display:flex><span>    config <span style=color:#f92672>=</span> my_module<span style=color:#f92672>.</span>config
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> secrets_module:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> attr <span style=color:#f92672>in</span> dir(secrets_module<span style=color:#f92672>.</span>config):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> hasattr(secrets_module<span style=color:#f92672>.</span>config, attr) <span style=color:#f92672>and</span> hasattr(config, attr):
</span></span><span style=display:flex><span>                setattr(config, attr, getattr(secrets_module<span style=color:#f92672>.</span>config, attr))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Continue with your logic</span>
</span></span></code></pre></div><h1 id=how-this-works>How This Works</h1><ol><li><strong>Main Configuration Loading:</strong> The script loads the main configuration from appconfig.py, which contains non-sensitive data and placeholders for sensitive values.</li><li><strong>Secrets Loading:</strong> If the secrets file (appconfig.secrets.py) exists, it loads sensitive information such as passwords or API keys.</li><li><strong>Secrets Injection:</strong> The values from the secrets file are used to override the placeholders in the main configuration.</li></ol><p>This way, your sensitive data is dynamically injected into the configuration at runtime, keeping it separate from your main codebase.</p><p>This method is easy to implement and requires minimal configuration. It allows you to manage secrets without complex tooling or external dependencies.</p><p>This approach provides a simple, effective way to manage secrets during development, following the best practice of never storing secrets in your codebase.</p><hr><ul class=pager><li class=previous><a href=/automate-all-the-things-a-manifesto-for-building-better-teams/ data-toggle=tooltip data-placement=top title="Automate All The Things: A Manifesto for Building Better Teams">&larr;
Previous Post</a></li><li class=next><a href=/now-generating-url-slugs-natural-language-processing/ data-toggle=tooltip data-placement=top title="Now Generating URL Slugs With Natural Language Processing!">Next
Post &rarr;</a></li></ul></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>Contents</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href=https://x.com/michailkonst><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://github.com/michailkonst><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://www.linkedin.com/in/michailkonstant/><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; Michail Konst 2025</p></div></div></div></footer><script>function loadAsync(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(null,e)},!1),i.parentNode.insertBefore(n,i)}</script><script>$("#tag_cloud").length!==0&&loadAsync("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js",function(){var e=document.querySelector("nav");e&&FastClick.attach(e)})</script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,a=$(_containerSelector),r=a.find("h1,h2,h3,h4,h5,h6");return $(e).html(""),r.each(function(){n=$(this).prop("tagName").toLowerCase(),o="#"+$(this).prop("id"),t=$(this).text(),i=$('<a href="'+o+'" rel="nofollow" title="'+t+'">'+t+"</a>"),s=$('<li class="'+n+'_nav"></li>').append(i),$(e).append(s)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")}),loadAsync("/js/jquery.nav.js",function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script></body></html>